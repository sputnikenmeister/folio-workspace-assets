// ///////////////////////////////////
// Layout
// ///////////////////////////////////

// - - - - - - - - - - - - - - - - - -
// Abstract rules
// - - - - - - - - - - - - - - - - - -
@import "../includes/media-queries";
@import "../includes/transitions";

// -----------------------------------
// Root container
// -----------------------------------

html, body {
	height: 100%;
}

#container {
	width: 100%;
	height: 100%;
	display: block;
	overflow: hidden;
	min-width: $page_width;
	@include media(desktop-small) {
		min-width: $page_width_large;
	}
}

// - - - - - - - - - - - - - - - - - -
// footer
// - - - - - - - - - - - - - - - - - -
//@import "views/footer";

// ------------------------------------
// Body init
// ------------------------------------
.app-ready #container {
	transition:
		visibility $duration $delay step-start,
		opacity $duration $delay $ease;
	visibility: visible;
	opacity: 1;
}
.app-initial #container {
	visibility: hidden;
	opacity: 0;
}
// body.skip-transitions *,
.app-initial * {
	@include skip_transitions;
}

// ------------------------------------
// Dynamic color
// ------------------------------------
// body default color values specified in "_base.scss"

.color-fg05 {
	color: lighten($color, 40%);
	border-color: lighten($color, 60%);
}
body, .color-tx {
	// transition:
	// 	background-color $duration $ease $delay * 2,
	// 	color $duration $ease $delay * 2;
	transition-property: background-color, color;
	transition-delay: $delay*1 + 0.001s;
	transition-duration: $duration - 0.001s;
	transition-timing-function: $ease;
}

// -----------------------------------
// Layer ordering
// -----------------------------------

#container {
	z-index: 1;
	#navigation {
		// z-index: 1;
		@at-root .transform-wrapper {
			z-index: 1;
			.list {
				z-index: 1;
			}
		}
	}
	#content {
		// z-index: 1;
		@at-root .media-carousel {
			z-index: 0;
			&.scrolling, &.panning {
				z-index: 2;
			}
			.carousel-item {
				z-index: 0;
				&.selected {
					z-index: 1;
				}
			}
		}
	}
}

// ///////////////////////////////////
// Layout utilities
// ///////////////////////////////////

// - - - - - - - - - - - - - - - - - -
// layout variables
// - - - - - - - - - - - - - - - - - -
$header_height_landscape: 1.25rem;
$header_height_portrait: 2.25rem;
$nav_height_landscape: 9rem;
$nav_height_portrait: 15rem;//13.5rem;//14.25rem;
$nav_height_landscape_right: $nav_height_landscape + 1.5rem;
$footer_height: 3rem;

$nav_collapse_extra: 28rem;

// translate wrapper function
// - - - - - - - - - - - - - - - - - -
@mixin nav_translate($x, $y) {
	transform: translate3d($x, $y, 0);
	// transform: translate($x, $y);
}

// %page_region_left {
// 	left: calc(50% - #{$page_width/2});
// 	@include media(desktop-small) {
// 		left: calc(50% - #{$page_width_large/2});
// 	}
// }
// %page_region_width {
// 	width: $page_width;
// 	@include media(desktop-small) {
// 		width: $page_width_large;
// 	}
// }
// %page_region_maxwidth {
// 	max-width: $page_width;
// 	@include media(desktop-small) {
// 		max-width: $page_width_large;
// 	}
// }
// %page_region_abs {
// 	position: absolute;
// 	@extend %page_region_left;
// 	@extend %page_region_maxwidth;
// }
// %page_region_static {
// 	margin: 0 auto;
// 	@extend %page_region_maxwidth;
// }

// leaf elements
// - - - - - - - - - - - - - - - - - -
%leaf-content {
	box-sizing: border-box;
	padding-left: $hu;
	padding-right: $hu;
	&, * {
		user-select: none !important;
	}
}

// ///////////////////////////////////
// media query : Default
// ///////////////////////////////////

@import "navigation";
@import "content";

// -----------------------------------
// navigation
// -----------------------------------
#navigation {
	// @extend %page_region_static;
	margin: 0 auto;
	max-width: $page_width;
	position: relative;
	top: 0;//$header_height_portrait;
	padding-top: $header_height_portrait;
	
	// @include media(desktop-small) {
	// 	max-width: $page_width_large;
	// }
}

// nav_list
// -----------------------------------
%nav_list {
	position: absolute;
	display: inline-block;
	transform-style: preserve-3d;
	@include nav_translate(0, #{$nav_height_portrait - 4.5rem});
}
.with-bundle %nav_list {
	// padding-top: 1.5rem;
	@include nav_translate(0, 0);
}

// bundle-list
// - - - - - - - - - - - - - - - - - -
#bundle-list {
	@extend %nav_list;
	width: $main_width - $aside_width;
}

#keyword-list {
	@extend %nav_list;
	width: $aside_width;
	.list-item {
		width: 100%;
		height: 1.5rem;
	}
	.list-group {
		height: 0;
		width: calc(100% - #{$gutter});
		span {
			width: 100%;
			@include nav_translate(-100%, 0rem);
		}
	}
}

// site-name
// - - - - - - - - - - - - - - - - - -
#site-name {
	@include nav_translate(-1px, 0);
}
.with-bundle #site-name {
	@include nav_translate(-100%, 0);
}

// transform-wrappers
// -----------------------------------
.transform-wrapper {
	position: absolute;
	display: inline-block;
	// top: 0;
	left: 0;
}

// site-name-wrapper
// - - - - - - - - - - - - - - - - - -
#site-name-wrapper {
	width: 100%;
	height: $nav_height_portrait;
}

// bundle-list-wrapper
// - - - - - - - - - - - - - - - - - -
#bundle-list-wrapper {
	
}

// keyword-list-wrapper
// - - - - - - - - - - - - - - - - - -
#keyword-list-wrapper {
	left: $main_width;
	@include nav_translate(0, 0);
}

// -----------------------------------
// content
// -----------------------------------
#content {
	overflow: hidden;
	position: absolute;
	box-sizing: border-box;
	top: 0;
	width: 100%;
	height: 100%;
}

// image-carousel
// - - - - - - - - - - - - - - - - - -
//.label-carousel,
.media-carousel {
	width: 100%;
	min-width: $page_width;
	top: $nav_height_portrait + $header_height_portrait;
	@include nav_translate(0,0);
	.carousel-item {
		left: calc(50% - #{$page_width/2});
	}
	.carousel-item.media-item {
		width: $page_width;
	}
	.carousel-item.sequence-renderer {
		padding-right: $hu*2;
	}
	//NOTE: empty-item narrow size
	.carousel-item.empty-item {
		width: $main_width - $aside_width + $hu*4 - 9px;
	}
}

.container-expanded .media-carousel {
	@include nav_translate(0, $nav_collapse_extra);
}
.removing-child.media-carousel .empty-item .content,
.removing-child.media-carousel .media-item img {
	// NOTE: do not fade-in images when removing carousel:
	// Set delay longer than `.removing.media-carousel`'s fade-out duration,
	transition-delay: $delay * 5;
	transition-timing-function: step-end;
}

// media-caption-stack
// - - - - - - - - - - - - - - - - - -
.media-caption-stack {
	@include nav_translate(0, 0);
	position: relative;
	margin: 0 auto;
	width: $page_width;
	top: $header_height_portrait + $nav_height_portrait;
	margin-top: -3.75rem;
}
.container-expanded .media-caption-stack {
	@include nav_translate(0, $nav_collapse_extra);
}
.container-expanded .media-caption-stack,
.media-caption-stack.removing-child {
	& > .current {
		opacity: 0;
	}
}

// media-dotnav
// - - - - - - - - - - - - - - - - - -
.media-dotnav {
	@include nav_translate(0,0);
	bottom: 3rem;
	// top: $header_height_portrait;// + 2.5rem;
	// top: $nav_height_portrait - 1.5rem;	
	text-align: center;
	position: absolute;
	width: $page_width;
	left: 0; right: 0;
	margin: 0 auto;
	padding: 0 $hu;
}
.media-dotnav {
	transition: opacity $duration - 0.001s $ease 0.001s;
	opacity: 1;
}
.without-media, .container-expanded, .container-changing {
	.media-dotnav {
		opacity: 0;
	}
}
// .removing-child.media-dotnav > li {
// 	transition-delay: $delay * 5;
// 	transition-timing-function: step-end;
// }

// ///////////////////////////////////
// media query : $desktop-small
// ///////////////////////////////////

@include media(desktop-small) {
	
	// -----------------------------------
	// navigation
	// -----------------------------------
	#navigation {
		top: 0;//$header_height_landscape;
		padding-top: $header_height_landscape;
		max-width: $page_width_large;
	}

	// nav_list
	// -----------------------------------
	%nav_list {
		@include nav_translate(0, #{$nav_height_landscape - 1.5rem});
	}
	.with-bundle %nav_list {
		@include nav_translate(0, 0);
	}

	// bundle-list
	// - - - - - - - - - - - - - - - - - -
	#bundle-list {
		width: $main_width_large - $aside_width_large;
	}
	.with-bundle #bundle-list {
		width: $aside_width_large;
	}

	// keyword-list
	// - - - - - - - - - - - - - - - - - -
	#keyword-list {
		width: $aside_width_large;
	}
	.with-bundle.default-layout #keyword-list {
		@include nav_translate(0, #{$nav_height_landscape - 0.5rem});
	}
	.with-bundle.right-layout #keyword-list {
		@include nav_translate(0, #{$nav_height_landscape_right - 0.5rem});
	}
	.with-bundle.default-layout .container-expanded #keyword-list {
		@include nav_translate(0, 0);
	}
	.with-bundle.right-layout .container-expanded #keyword-list {
		@include nav_translate(0, 0);
	}

	// keyword-list list-group
	// - - - - - - - - - - - - - - - - - -
	.default-layout #keyword-list .list-group {
		width: calc(100% - #{$gutter});
	}
	.with-bundle .navigation:not(.container-expanded) #keyword-list .list-group {
		height: 1.5rem;
		span {
			@include nav_translate(-0.5px, 0.0rem);
		}
	}

	// NOTE: .container-expanded with empty-item alignment
	// $item-type: media;
	$item-type: bundle;

	// site-name
	// - - - - - - - - - - - - - - - - - -
	.with-#{$item-type} .container-expanded #site-name {
		@include nav_translate(-1px, 0);
	}
	.with-#{$item-type}.right-layout .container-expanded #site-name {
		@include nav_translate(-100%, 0);
	}

	// transform-wrappers
	// -----------------------------------
	.transform-wrapper {
		transform-style: preserve-3d;
		@include nav_translate(0, 0);
	}

	// site-name-wrapper
	// - - - - - - - - - - - - - - - - - -
	#site-name-wrapper {
		height: $nav_height_landscape;
	}
	.right-layout #site-name-wrapper {
		height: $nav_height_landscape_right;
	}
	
	// bundle-list-wrapper
	// - - - - - - - - - - - - - - - - - -
	.with-#{$item-type} .container-expanded #bundle-list-wrapper {
		@include nav_translate($aside_width_large, 0);
	}
	.with-#{$item-type}.right-layout .container-expanded #bundle-list-wrapper {
		@include nav_translate(0, 0);
	}
	
	// FIXME
	$_fixme_kw_left: $main_width_large;
	$_fixme_empty_width: $page_width_large - ($hu*2 + 7px);
	$_fixme_empty_padding: $aside_width_large - ($hu*2 + 7px);
	
	// keyword-list-wrapper
	// - - - - - - - - - - - - - - - - - -
	#keyword-list-wrapper {
		left: $_fixme_kw_left; // FIXME
	}
	.with-media #keyword-list-wrapper {
		@include nav_translate(-$_fixme_kw_left, 0); // FIXME
	}
	.with-#{$item-type} .container-expanded #keyword-list-wrapper {
		@include nav_translate(0, 0);
	}
	.with-#{$item-type}.right-layout #keyword-list-wrapper {
		@include nav_translate(0, 0);
	}
	
	// -----------------------------------
	// content
	// -----------------------------------
	#content {
	// 	padding-top: $nav_height_landscape + $header_height_landscape;
	}
	
	// image-carousel
	// - - - - - - - - - - - - - - - - - -
	.media-carousel {
		min-width: $page_width_large;
		.carousel-item {
			left: calc(50% - #{$page_width_large/2});
			width: $page_width_large;
		}
		.carousel-item.empty-item {
			width: $_fixme_empty_width; // FIXME
			padding-right: $_fixme_empty_padding; // FIXME
			padding-left: 0;
		}
	}
	.default-layout .media-carousel {
		top: $nav_height_landscape + $header_height_landscape;
		.carousel-item.media-item {
			padding-left: $aside_width_large;
			padding-right: 0;
		}
		.carousel-item.video-renderer,
		.carousel-item.sequence-renderer {
			padding-right: $hu*2;
		}
		.carousel-item.empty-item .content {
			transform: translate(0, 0);
		}
		// FIXME: .container-expanded animation
		&.disabled .carousel-item.empty-item.selected .content {
			transform: translate($aside_width_large, 0);
		}
		.carousel-item.empty-item .content {
			// transition: all #{$duration - 0.001s} $ease 0.001s;
			transition-property: transform, opacity;
			transition-duration: #{$duration - 0.001s};
			transition-timing-function: $ease;
			transition-delay: #{$delay*1 + 0.001s}, #{$delay*0 + 0.001s};
		}
	}
	// .default-layout .container-expanded .media-carousel .empty-item.selected .content {
	// 	transform: translate($aside_width_large, 0);
	// }
	.right-layout .media-carousel {
		top: $nav_height_landscape_right + $header_height_landscape;
		.carousel-item.media-item {
			padding-right: $aside_width_large;
			padding-left: 0;
		}
	}
	
	// media-caption-stack
	// - - - - - - - - - - - - - - - - - -
	.media-caption-stack {
		width: $page_width_large;
		.content {
			margin-left: $aside_width_large;
			width: $main_width_large;
		}
	}
	.default-layout .media-caption-stack {
		top: $header_height_landscape;
		margin-top: 0;
		@include nav_translate(0, 0);
	}
	.default-layout .container-expanded .media-caption-stack {
		@include nav_translate(0, $nav_collapse_extra);
	}
	.right-layout .media-caption-stack {
		top: $header_height_landscape + $nav_height_landscape_right;
		margin-top: -2.5rem;
	}
	.right-layout .container-expanded .media-caption-stack {
		@include nav_translate(0, $nav_collapse_extra);
	}
	
	// media-dotnav
	// - - - - - - - - - - - - - - - - - -
	.media-dotnav {
		bottom: 0.75rem;
		width: $page_width_large;
		padding-left: $aside_width_large + $hu;
	}
	
	// - - - - - - - - - - - - - - - - - -
	// NOTE: typeface overrides
	// - - - - - - - - - - - - - - - - - -
	.right-layout .media-caption-stack .content > * {
		@include small_caps($lead: 1.5rem);
	}

}
