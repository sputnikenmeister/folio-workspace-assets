// ///////////////////////////////////
// media query : default
// ///////////////////////////////////

// ///////////////////////////////////
// Definitions
// ///////////////////////////////////

// layout variables
// - - - - - - - - - - - - - - - - - -
$nav_top_port: 2.5rem;
$nav_height_port: 12rem; //13.5rem;//14.25rem;
$nav_collapse_offset: map-get($temp, collapse_offset) * 1px; //28rem;

// block definitions
// - - - - - - - - - - - - - - - - - -
%nav_list {
	position: absolute;
	display: inline-block;
	// display: block;
	will-change: transform;
	// transform-style: preserve-3d;
	// transform: move();
	// box-sizing: content-box;
}
// leaf elements
// - - - - - - - - - - - - - - - - - -
%leaf_content {
	box-sizing: border-box;
	padding-left: $hu;
	padding-right: $hu;
	.label {
		padding: 0 #{$hu};
		margin: 0 -#{$hu};
	}
	&, * {
		@include user_select(none);
	}
}

@import "views/default.colors";
@import "views/default.mdown";

// ///////////////////////////////////
// Root
// ///////////////////////////////////

html {
	font: #{$vu}/1.5 $base_font;
}

body {
	// line-height: 1.5rem;
	-moz-osx-font-smoothing: grayscale;
}

body,
html {
	height: 100%;
	overflow-x: hidden;
	overscroll-behavior: none;
}

// Container
// - - - - - - - - - - - - - - - - - -
#container {
	width: 100%;
	height: 100%;
	display: block;
	overflow: hidden;
	min-width: $page_width;
}

// ///////////////////////////////////
// navigation
// ///////////////////////////////////

#navigation {
	position: relative;
	margin: 0 auto;

	max-width: $page_width;
	min-height: $nav_height_port;
	// padding-top: $nav_top_port;
	top: $nav_top_port;
}
.transform-wrapper {
	// @extend %nav_list;
	position: absolute;
	display: inline-block;
	// display: block;
	will-change: transform;
	// transform-style: preserve-3d;
}

// FilterableList
// ===================================
@import "components/filterable";

// .filterable {
	.list-item {
		@extend %leaf_content;
		white-space: nowrap;
		cursor: pointer;
		a {
			display: inline-block;
			transition: tx(color, 1, 1);
		}
		.label {
			line-height: 0;
			// margin: 0 #{-$hu * 0.75} 0 #{-$hu};
			// padding: 0 #{$hu * 0.75} 0 $hu;
			// display: inline-block;
		}
	}
	.list-group {
		@extend %leaf_content;
		white-space: nowrap;
		.label {
			display: inline-block;
		}
	}
// }

// bundle-list
// ===================================
#bundle-list {
	@extend %nav_list;
	width: $main_width - $aside_width;
	padding-top: $nav_height_port;
	padding-bottom: 1.5rem;
	min-height: 4.5rem;

	@include heading_font(600, 1.9999999rem, 2rem, -1px);

	.list-item {
		// width: $main_width - $aside_width;
		width: 100%;
		height: 1em;
		.completed {
			display: none;
		}
		em {
			font-style: normal;
			font-weight: 400;
		}
	}
	&.collapsed {
		.list-item {
			a {
				color: inherit;
			}
		}
	}
	&:not(.collapsed) {
		// .list-group,
		.list-item {
			&:not(.selected) a {
				color: inherit;
			}
		}
	}
}
.with-bundle #bundle-list {
	padding-top: 1.5rem;
}
// bundle-list-wrapper
// - - - - - - - - - - - - - - - - - -
#bundle-list-wrapper {
	left: 0;
}

// keyword-list
// ===================================
#keyword-list {
	@extend %nav_list;
	width: $aside_width;
	padding-top: #{$nav_height_port - 0.25rem};
	padding-bottom: 1.5rem;
	.list-item {
		// width: 100%;
		width: $aside_width;
		height: 1.5rem;
		.label {
			// font-size: 13px;
			font-size: 1.08333333rem;
		}
	}
	.list-group {
		// NOTE: in js, this value is ignored when height is zero
		margin-top: 0.5rem;
		white-space: nowrap;
		height: 0;

		$list_group_width: $aside_width - $gutter - $hu*2;
		width: $aside_width; //$list-group-width;
		// width: calc(100% - #{$gutter});
		.label {
			@include small_caps($lead: 0);
			display: inline-block;
			width: $list_group_width;
			// transform: movel-$list_group_width, 0);
			// width: 100%;
			transform: moveX(-100%);
			box-sizing: border-box;

			// padding: 0 #{0.5*$hu};
			// margin: 0 #{-0.5*$hu};

			& > span {
				padding: 0.25em 1rem;
				margin: -0.25em -1rem;

				// padding: 0.25rem #{0.5*$hu};
				// margin: -0.25rem #{-0.5*$hu};

				// padding-top: 0.25rem;
				// padding-bottom: 0.25rem;
				// margin-top: -0.25rem;
				// margin-bottom: -0.25rem;
			}
		}
	}
	&:not(.collapsed) {
		.list-item.excluded a {
			color: inherit;
		}
		.list-item.selected a {
			text-decoration: underline;
		}
	}
	@at-root {
		.app-initial &,
		.without-bundle &,
		&.collapsed {
			.list-item a {
				color: inherit;
			}
		}
	}
}
.with-bundle #keyword-list {
	padding-top: 1.25rem;
}

// keyword-list list-group
// - - - - - - - - - - - - - - - - - -
.without-bundle {
	#bundle-list, #keyword-list {
		// padding-top: 0 !important;
		padding-bottom: 0;
		min-height: 0;
		&.collapsed {
			.list-group, .list-item {
				height: 0;
			}
		}
	}
}

// keyword-list-wrapper
// - - - - - - - - - - - - - - - - - -
#keyword-list-wrapper {
	left: $main_width;
	transform: moveX();
}

// site-name
// ===================================
#site-name {
	@include heading_font(600, 1.9999999rem, 2rem);
	@extend %leaf_content;

	position: absolute;
	display: block;
	padding-top: 0.5rem;
	padding-bottom: 0.5rem;
	top: 1rem;
	transform: moveX();
	a {
		transition: tx(color, 1, 1);
	}
}
// .with-article,
.with-bundle {
	#site-name {
		transform: moveX(-100%);
	}
}
// site-name-wrapper
// - - - - - - - - - - - - - - - - - -
#site-name-wrapper {
	left: 0;
	// width: 100%;
	width: $aside_width;
	// width: auto;
	// transform: move();
}
// .with-bundle #site-name-wrapper {
// 	transform: moveX(-100%);
// }

// article-list
// ===================================
.article-button {
	@include heading_font(300, 1.9999999rem, 2rem);
	@extend %leaf_content;

	position: absolute;
	display: block;
	padding-top: 0.5rem;
	padding-bottom: 0.5rem;
	transform: moveX();
	a {
		visibility: visible;
		opacity: 1;
		transition: tx(visibility, 3, 0, step-start), tx(opacity, 1, 0), tx(color, 1, 1);
	}
}
.with-bundle .article-button {
	transform: moveX(-100%);
	a {
		visibility: hidden;
		opacity: 0;
		transition: tx(visibility, 3, 0, step-end), tx(opacity, 1, 2), tx(color, 1, 1);
	}
}
// no transition if initial visibility is hidden
.app-initial.with-bundle .article-button {
	a {
		transition: none;
	}
}
.article-button#about-button {
	top: 1rem;
}

// article-list-wrapper (vertical movements)
// - - - - - - - - - - - - - - - - - -
#article-list-wrapper {
	left: 0;
	width: $aside_width;
	transform: moveY(2rem);
}
// .with-article #article-list-wrapper {
// 	transform: move(0, 0);
// }

// @include media(desktop-small) {
// 	#about {
// 		// hiding
// 		transition: tx(visibility, 3, 0, step-end), tx(opacity, 1, 2), tx(transform, 1, 2);
// 	}
// 	&.route-article-item,
// 	&.route-bundle-list,
// 	&.route-root {
// 		#about {
// 			// showing
// 			transition: tx(visibility, 3, 0, step-start), tx(opacity, 1, 0), tx(transform, 1, 0);
// 		}
// 	}
// }

// nav-graph
// ===================================
#nav-graph {
	@extend %nav_list;
	// box-sizing: border-box;
	box-sizing: content-box;
	// padding: 1.5rem 0;
	padding: 0;
	// right: 0;
	width: $page_width;
	// height: 12rem;

	opacity: 0;
	transition: tx(opacity, 1, 0);
	
	@at-root .container-expanded:not(.container-changing) & {
		opacity: 1;
	}
	@at-root .container-collapsed.container-changing & {
		transition: tx(opacity, 1, 0), tx(height, 1, 0, step-end);
	}
	@at-root .skip-transitions & {
		@include skip_transitions;
	}
}
.container-collapsed #nav-graph {
	opacity: 0;
}

// nav-graph unavailable (bundles<>keywords)
// - - - - - - - - - - - - - - - - - -
.no-canvas {
	// keyword-to-bundles
	// - - - - - - - - - - - - - - - - - -
	.with-bundle #keyword-list:not(.collapsed) .list-item.selected .label {
		text-decoration: underline;
	}
	.with-bundle #bundle-list.has-excluded:not(.collapsed) .list-item:not(.excluded) .label {
		text-decoration: underline;
	}
}

// ///////////////////////////////////
// content
// ///////////////////////////////////

#content {
	overflow: hidden;
	position: absolute;
	top: 0;
	bottom: 0; //height: 100%;
	left: 0;
	right: 0; //width: 100%;
}

// media-carousel
// ===================================

@import "components/carousel";

.media-carousel {
	position: absolute;
	transform: moveY();
	@at-root .container-expanded & {
		transform: moveY($nav_collapse_offset);
		// transform: moveY(calc(#{$nav_collapse_offset} + 3rem));
	}
}
.media-carousel {
	overflow: hidden;
	width: 100%;
	min-width: $page_width;
	bottom: 0;

	top: $nav_top_port + $nav_height_port;
	padding-top: 4.5rem;
	padding-bottom: 4.5rem;
	$carousel_item_height: calc(100% - 9rem);

	// top: 0;//$nav_top_port;
	// padding-top: $nav_top_port + $nav_height_port;
	// padding-bottom: 4.5rem;
	// $carousel_item_height: calc(100% - #{$nav_height_port + 4.5rem});

	.carousel-item {
		// padding-top: 1.5rem;
		// padding-bottom: 1.5rem;
		left: calc(50% - #{$page_width/2 + $hu});
		margin-left: $hu;
		margin-right: $hu;
	}
	.empty-item {
		height: auto;
		max-height: $carousel_item_height;
		overflow: visible;
		// FIXME: empty-item narrow px adjust
		// width: $page_width/2 + $hu - 9px;
		width: $main_width - 12px;
	}
	.media-item {
		height: $carousel_item_height;
		width: $page_width;
	}
	.playable-renderer .progress-meter {
		top: -3.5rem;
		right: 0;
	}
}

// carousel leaf elements
// - - - - - - - - - - - - - - - - - -
.empty-item .content p,
.stack .content {
	@extend %leaf_content;
}

.media-item .sizing {
	margin-left: $hu;
	margin-right: $hu;
}

// NOTE
// Do not fade-out content when removing carousel:
// set delay longer than `.carousel.removing-child`'s
// fade-out duration.
.carousel.removing-child .carousel-item .content {
	transition: tx(opacity, 0, 5, step-end) !important;
	// transition-delay: $delay * 5 !important;
	// transition-timing-function: step-end !important;
}

// media-caption-stack
// ===================================

@import "components/stack";

.media-caption-stack {
	position: relative;
	width: $page_width;
	margin: 4.5rem auto 0;
	top: $nav_top_port + $nav_height_port;

	transform: moveY();
	@at-root .container-expanded & {
		transform: moveY($nav_collapse_offset);
	}
	& > .stack-item {
		top: auto;
		bottom: 0;
	}
	&.disabled > .stack-item {
		opacity: 0;
	}
	.content {
		margin: 1.5rem auto;
	}
	.content p {
		@include heading_font($size: 20px, $weight: 300, $lead: 26px);
		margin-left: -1px;
		//@include heading_font($size: 1.666rem,
		//	$weight: 300, $lead: 2rem);
	}
}

// media-dotnav
// ===================================

@import "components/selectable.dots-fontface.scss";

.media-dotnav {
	text-align: center;
	margin: 0 auto;
	padding: 0 $hu;

	position: absolute;
	width: $page_width;
	// height: 1.5rem;
	bottom: 1rem;
	left: 0;
	right: 0;
	transform: move();

	transition: tx(opacity, 1, 0);
	opacity: 1;
	@at-root .without-media &,
		.container-expanded &,
		.container-changing &,
		.container-changed & {
		opacity: 0;
	}
	.list-item {
		padding: 0 0.5rem;
		a {
			color: inherit;
		}
	}
}

// article-view
// ===================================
.article-view {
	position: relative;
	width: $page_width;
	margin: -1rem auto 4.5rem;
	top: $nav_top_port;
	bottom: 0.75em;

	&.markdown-html {
		h1, h2, h3, h4, p {
			padding-left: $hu;
			padding-right: $hu;
		}
		h1, h2, p {
			margin-left: $aside_width;
		}
		h3, h4 {
			width: $aside_width;
			float: left;
			clear: both;
		}
	}
}

// // media-progress-wrapper
// // - - - - - - - - - - - - - - - - - -
// #media-progress-wrapper {
// 	position: absolute;
// 	transform: move();
//
// 	right: calc(50% - #{$page_width/2});
// 	top: 2.5rem;
// 	margin: 0 $hu;
// 	box-sizing: content-box;
// 	// width: 34px; height: 34px;
// 	width: 2.8rem; height: 2.8rem;
//
// 	font-family: "FolioFigures", monospace;
// 	font-weight: normal;
//
// 	transition: tx(opacity, 1, 0);
// 	opacity: 1;
// 	@at-root .without-media &,
// 		.container-expanded &,
// 		.container-changing &,
// 		.container-changed & {
// 		opacity: 0;
// 	}
// }

// #content:after {
// 	position: absolute;
// 	margin: 0 auto;
// 	max-width: $page_width;
// 	left: 0; right: 0;
// 	top: $nav_top_port + $nav_height_port;
// 	height: 1px;
// 	background-color: blue;
// 	content: ' ';
// }
