// -----------------------------------
// .playable-renderer
// -----------------------------------

.playable-renderer {
	.content-size,
	.media-size {
		position: absolute;
		display: inline-block;
	}
	.content > .content-size {
		width: 100%;
		height: 100%;
		top: 0;
		left: 0;
		bottom: 0;
		right: 0;
	}
}

// -----------------------------------
// .playable-renderer .overlay
// -----------------------------------

// .overlay visibility
// - - - - - - - - - - - - - - - - -
// .playable-renderer .overlay {
// 	visibility: hidden;
// 	opacity: 0;
// }
// .playable-renderer.selected .overlay {
// 	visibility: visible;
// 	opacity: 1;
// }
// .carousel .playable-renderer .overlay {
// 	transition-property: visibility, opacity;
// 	transition-timing-function: step-start, $ease;
// 	transition-duration: $duration * 3;
// }
// .carousel:not(.panning) .playable-renderer.selected .overlay {
// 	transition-property: visibility, opacity;
// 	transition-timing-function: step-end;
// 	transition-duration: $duration * 1;
// }

// -----------------------------------
// .playable-renderer .play-toggle
// -----------------------------------

@function symbol-url($url) {
	// @return base64_encode($url);
	@return image-url($url);
}

@keyframes flashEven {
	from {
		opacity: 1.00;
	}
	50% {
		opacity: 1.00;
	}
}
@keyframes flashOdd {
	from {
		opacity: 1.00;
	}
	50% {
		opacity: 1.00;
	}
}
// from { opacity: 0.00; }
// 10%  { opacity: 1.00; }
// to   { opacity: 0.00; }

// - - - - - - - - - - - - - - - - -
// .play-toggle
// - - - - - - - - - - - - - - - - -
.playable-renderer {
	// - - - - - - - - - - - - - - - - -
	// box/background position
	// - - - - - - - - - - - - - - - - -
	.play-toggle {
		margin: 1rem;
		top: 0;//20%;//1em;
		bottom: 0;//20%;//1em;
		left: 0;//20%;//1em;
		right: 0;//20%;//1em;
		width: auto;
		height: auto;
		cursor: pointer;
		display: block;
		position: absolute;

		background-size: 49px 49px;
		background-position: center center;
		background-repeat: no-repeat;
	}
	// :not(.started) .play-toggle {
	// .started.playing.waiting .play-toggle {
	// 	background-size: 69px 69px;
	// }
	// .play-toggle {
	// 	$size: 49px;//50%;//12em;
	// 	width: $size; height: $size;
	// 	left: calc(50% - #{$size/2}); top: calc(50% - #{$size/2});
	// 	// margin-left: $size/2; margin-top: $size/2;
	// }
	// .play-toggle-hitarea {} // hit-area

	// - - - - - - - - - - - - - - - - -
	// symbols
	// - - - - - - - - - - - - - - - - -
	.paused:not(.started) .play-toggle,
	.play-toggle,
	.playing .play-toggle {
		background-image: symbol-url("symbols/playback-play.svg");
	}
	.paused .play-toggle {
		background-image: symbol-url("symbols/playback-pause.svg");
	}
	.playing.waiting .play-toggle {
		background-image: symbol-url("symbols/playback-wait.svg");
	}
	.paused.ended .play-toggle {
		background-image: symbol-url("symbols/playback-replay.svg");
	}

	// - - - - - - - - - - - - - - - - -
	// opacity animation
	// - - - - - - - - - - - - - - - - -
	// .play-toggle { opacity: 0; };
	// :not(.started) .play-toggle { opacity: 1; }
	.play-toggle {
		opacity: 1;
	};
	.started {
		.play-toggle {
			opacity: 0;
		};
		&.playing.waiting .play-toggle {
			opacity: 1;
		}
		&.paused.ended .play-toggle {
			opacity: 1;
		}
		@at-root :not(.scrolling) & {
			&.playing .play-toggle {
				animation: $duration*2 $ease flashOdd;
			}
			&.paused .play-toggle {
				animation: $duration*2 $ease flashEven;
			}
		}
	}
}

// - - - - - - - - - - - - - - - - - -
//  .playable-renderer .controls
// - - - - - - - - - - - - - - - - - -
.playable-renderer {
	.controls {
		position: absolute;
		// top: 100%;
		// right: 0;
		// height: 4.5rem;
	}

	// .control-box
	// - - - - - - - - - - - - - - - - -
	.control-box {
		display: flex;
		flex-direction: row;

		& > * {
			flex: 0 1 auto;
			//padding: 0 0.5rem;
			margin: 0 0.5rem;
			align-self: center;
		}
		//& > *:first-child {
		//	margin-right: 0;
		//}
	}
	.bottom-bar,
	.top-bar {
		position: absolute;
		width: calc(100% + 1rem);
		height: auto;
		margin: 0.5rem -0.5rem;
	}
	.bottom-bar {
		top: 100%;
		margin-top: 1.5rem;
		justify-content: space-between;
	}
	.top-bar {
		// NOTE: using direction, for crossbrowser consistency
		// [ direction: rtl | ltr ]
		// [ justify-content: flex-start | flex-end ]
		direction: rtl;
		bottom: 100%; // top: -3.5rem;
		margin-bottom: 1.5rem;
	}

	// .control-box > *
	// - - - - - - - - - - - - - - - - -
	// NOTE: Fade controls while scrolling ONLY. For other states
	// (not-selected, disabled), an ancestor will be shown/hidden.
	.controls > * {
		opacity: 0;
		visibility: hidden;
	}
	&.ready.selected .controls > * {
		transition: tx(opacity, 1, 0), tx(visibility, 1, 0);
		opacity: 1;
		visibility: visible;
		@at-root .scrolling & {
			opacity: 0;
			visibility: hidden;
		}
		// @at-root .disabled & { }
	}
}

// @include media(desktop-small) {
// 	.playable-renderer {
// 		// .progress-meter {
// 		// 	top: 0; right: -$hu*2;
// 		// 	// &.dev { transform: translate(0, -3rem); }
// 		// }
// 		.top-bar.control-box {
// 			-webkit-flex-direction: column;
// 			-ms-flex-direction: column;
// 			flex-direction: column;
// 			// -webkit-justify-content: flex-start;
// 			// justify-content: flex-start;
// 			direction: ltr;
// 			top: 0; left: 100%;
// 			width: auto; height: calc(100% + 1rem);
// 			margin: -0.5rem 1.25rem;
// 			& > * {
// 				padding: 0.5rem 0rem;
// 			}
// 		}
// 	}
// }

// - - - - - - - - - - - - - - - - - -
//  .playable-renderer children
// - - - - - - - - - - - - - - - - - -
.playable-renderer {

	// .fullscreen-toggle
	// - - - - - - - - - - - - - - - - -
	.fullscreen-toggle {
		line-height: 0;
		cursor: pointer;
		border-radius: 0.2rem;
		&:hover {
			background-color: hsla(0,0,100%,0.25);
			@at-root .color-dark & {
				background-color: hsla(0,0,0%,0.25);
			}
		}
		&:active {
			background-color: hsla(0,0,100%,0.5);
			@at-root .color-dark & {
				background-color: hsla(0,0,0%,0.5);
			}
		}
		svg {
			width: 1em;
			height: 1em;
			padding: 0.5em;
		}
	}

	// .progress-meter
	// - - - - - - - - - - - - - - - - -
	.progress-meter {
		font-family: "FolioFigures", monospace;
		font-weight: normal;
		box-sizing: content-box;
		// width: 2.3rem;
		// height: 2.3rem;
		width: 2.8rem;
		height: 2.8rem;
		// transition: tx(opacity, 1, 0);
		// opacity: 0;
	}
	// @at-root :not(.scrolling) &.selected .progress-meter {
	// 	opacity: 1;
	// }

	// .timeline | .timecode
	// - - - - - - - - - - - - - - - - -
	// .timecode {
	// 	font-size: 85%;
	// 	letter-spacing: 1px;
	// 	font-variant-numeric: tabular-nums;
	// }
	// .control-box {
	// 	& > .timeline {
	// 		-webkit-flex: 1 0 auto;
	// 		flex: 1 0 auto;
	// 	}
	// 	// & > .svg-progress-meter {}
	// }
}

// .progress-meter per-renderer adjustments
// - - - - - - - - - - - - - - - - -
// .progress-meter {
// 	@at-root .playable-renderer & { font-size: 140%; }
// 	@at-root .sequence-renderer & { width: 2.5rem; height: 2.5rem; }
// 	@at-root .video-renderer & { width: 2.3rem; height: 2.3rem; }
// }
// .canvas-progress-meter {
// 	@at-root .sequence-renderer & { font-size: 80%; }
// 	@at-root .video-renderer & { font-size: 90%; }
// }
// .svg-progress-meter #label {
// 	@at-root .playable-renderer & { font-size: 140%; }
// 	@at-root .sequence-renderer & { font-size: 140%; }
// 	@at-root .video-renderer & { font-size: 133%; }
// }

// -----------------------------------
// VideoRenderer
// -----------------------------------
.video-renderer {
	transform-style: flat;
	// Closest to 680px at 16:9 -> 672x378
	// .content { max-width: 672px; }
	video {
		outline: 0 none;
		// object-fit: none;
		// background-color: #00CC00;
	}
	.crop-box {
		overflow: hidden;
		// background-color: #FF00FF;
		.poster,
		video {
			position: absolute;
			top: 0; left: 0; right: 0;
			// margin-top: -1px;
			top: -1px;
			// margin-left: -1px;

			// top: -5px;
			// left: -5px;
			// height: calc(100% + 10px);
			// width: calc(100% + 10px);

			// margin-bottom: -1px;
			// left: 0;
			// border-width: 0; margin: 0; padding: 0;
		}
	}
	.started .poster {
		visibility: hidden;
	}
}

// -----------------------------------
// SequenceRenderer
// -----------------------------------
.sequence-renderer {
	// .content {
	// 	box-shadow: none;//0 1rem 1rem -0.5rem rgba(0,0,0,0.5);
	// }
	.sequence {
		// box-shadow: 0 1rem 1rem -0.5rem rgba(0,0,0,0.5);

		// position: absolute;
		// width: 100%; height: 100%;
		// border-radius: inherit;
		overflow: hidden;
	}
	// .sequence-step
	// - - - - - - - - - - - - - - - - -
	.sequence-step {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;

		// NOTE: current on top, z-index changed last, opacity tx in outgoing image
		// z-index: 0; opacity: 0; visibility: hidden;
		// transition:
		// 	tx(opacity, 1.5, 0.5),
		// 	tx(visibility, 3, 0, step-end),
		// 	tx(z-index, 3, 0, step-end);
		// &.current {
		// 	z-index: 1; opacity: 1; visibility: visible;
		// 	// transition: z-index $duration*3 step-end;
		// 	transition: tx(z-index, 3, 0, step-end);
		// }

		// NOTE: current on top, z-index changed first, opacity tx in current image
		visibility: hidden;
		opacity: 0;
		z-index: 0;
		transition: tx(visibility, 3, 0, step-end), tx(opacity, 3, 0, step-end);
		&.current {
			visibility: visible;
			opacity: 1;
			z-index: 1;
			transition: tx(opacity, 1.5, 0.5);
		}

		&.error {
			// background-image: image-url("bg-missing-media.svg");
			background-image: base64-encode("bg-missing-media.svg");
			// background-color: transparent !important;
		}
	}
	.playback-error .sequence-step:not(.current) {
		transition: tx(visibility, 3, 0, step-end), tx(opacity, 1.5, 0.5);
	}


	// .media-border
	// - - - - - - - - - - - - - - - - -
	.media-border {
		transition: tx(opacity, 1.5, 0.5);
		opacity: 1;
	}
	.playback-error .media-border {
		opacity: 0;
	}

	// .overlay
	// - - - - - - - - - - - - - - - - -
	.overlay {
		z-index: 2;
	}
}
